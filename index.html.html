<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘ãƒ¼</title>
  <style>
    /* ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .game-container {
      width: 90%;
      max-width: 400px;
    }
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    button {
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #status {
      font-size: 16px;
      margin-left: 10px;
    }
    /* ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰å…¨ä½“ */
    #board {
      display: grid;
      gap: 2px;
      background-color: #333;
    }
    /* å„ã‚»ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ­£æ–¹å½¢ã«ã™ã‚‹ãŸã‚ã€padding-bottomã§æ¯”ç‡ã‚’å›ºå®šï¼‰ */
    .cell {
      background-color: #bbb;
      border: none;
      padding: 0;
      width: 100%;
      height: 0;
      padding-bottom: 100%; /* æ­£æ–¹å½¢ */
      position: relative;
      font-size: 1em;
      user-select: none;
    }
    /* é–‹ã„ãŸã‚»ãƒ« */
    .cell.revealed {
      background-color: #e0e0e0;
    }
    /* ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ãŸã‚»ãƒ« */
    .cell.flagged {
      background-color: #ffd700;
    }
    /* çˆ†å¼¾ã®ã‚»ãƒ« */
    .cell.mine {
      background-color: #ff4d4d;
    }
    /* ã‚»ãƒ«å†…ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½ç½®èª¿æ•´ */
    .cell span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <!-- ã‚²ãƒ¼ãƒ ä¸Šéƒ¨ã®ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼šãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼†ãƒªã‚»ãƒƒãƒˆ -->
    <div class="toolbar">
      <button id="toggle-mode">Reveal Mode</button>
      <button id="reset-game">Reset</button>
      <span id="status">Playing</span>
    </div>
    <!-- ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ -->
    <div id="board"></div>
  </div>

  <script>
    // ãƒœãƒ¼ãƒ‰ã®åŸºæœ¬è¨­å®šï¼šè¡Œæ•°ã€åˆ—æ•°ã€åœ°é›·æ•°
    const ROWS = 10;
    const COLS = 10;
    const MINES_COUNT = 15;

    let board = [];              // 2æ¬¡å…ƒé…åˆ—ã§å„ã‚»ãƒ«ã®çŠ¶æ…‹ã‚’ç®¡ç†
    let minePositions = [];      // åœ°é›·ã®ä½ç½®ã‚’ä¿æŒ
    let gameOver = false;
    let modeFlag = false;        // false: ã‚»ãƒ«ã‚’é–‹ãï¼ˆReveal Modeï¼‰ã€true: ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹ï¼ˆFlag Modeï¼‰
    let cellsRemaining = ROWS * COLS - MINES_COUNT; // åœ°é›·ä»¥å¤–ã®ã‚»ãƒ«ã®æ®‹ã‚Šæ•°

    const boardElement = document.getElementById("board");
    const toggleModeBtn = document.getElementById("toggle-mode");
    const resetGameBtn = document.getElementById("reset-game");
    const statusText = document.getElementById("status");

    // ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ã®ã‚°ãƒªãƒƒãƒ‰åˆ—æ•°ã‚’è¨­å®š
    boardElement.style.gridTemplateColumns = `repeat(${COLS}, 1fr)`;

    // ã‚»ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
    function Cell(row, col) {
      this.row = row;
      this.col = col;
      this.isMine = false;
      this.revealed = false;
      this.flagged = false;
      this.adjacentMines = 0;
      this.element = null;  // å¯¾å¿œã™ã‚‹DOMè¦ç´ 
    }

    // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ï¼ˆãƒœãƒ¼ãƒ‰ç”Ÿæˆã€åœ°é›·é…ç½®ã€DOMç”Ÿæˆï¼‰
    function initGame() {
      board = [];
      minePositions = [];
      gameOver = false;
      cellsRemaining = ROWS * COLS - MINES_COUNT;
      statusText.textContent = "Playing";
      boardElement.innerHTML = '';

      // ã‚»ãƒ«ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€DOMè¦ç´ ã¨ã—ã¦é…ç½®
      for (let row = 0; row < ROWS; row++) {
        board[row] = [];
        for (let col = 0; col < COLS; col++) {
          let cell = new Cell(row, col);
          board[row][col] = cell;
          let cellElement = document.createElement("button");
          cellElement.classList.add("cell");
          cellElement.setAttribute("data-row", row);
          cellElement.setAttribute("data-col", col);
          cellElement.style.touchAction = "manipulation"; // ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ã§ã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ é˜²æ­¢
          boardElement.appendChild(cellElement);
          cell.element = cellElement;

          // å·¦ã‚¯ãƒªãƒƒã‚¯/tapæ™‚ã®å‡¦ç†
          cellElement.addEventListener("click", onCellClick);
          // å³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†ï¼ˆPCå‘ã‘ï¼‰
          cellElement.addEventListener("contextmenu", onCellRightClick);
        }
      }

      // åœ°é›·ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®
      let minesPlaced = 0;
      while (minesPlaced < MINES_COUNT) {
        let r = Math.floor(Math.random() * ROWS);
        let c = Math.floor(Math.random() * COLS);
        if (!board[r][c].isMine) {
          board[r][c].isMine = true;
          minePositions.push({ row: r, col: c });
          minesPlaced++;
        }
      }

      // å„ã‚»ãƒ«ã«éš£æ¥ã™ã‚‹åœ°é›·æ•°ã‚’ç®—å‡º
      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          // åœ°é›·ã§ãªã„å ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
          if (!board[row][col].isMine) {
            board[row][col].adjacentMines = countAdjacentMines(row, col);
          }
        }
      }
    }

    // æŒ‡å®šã—ãŸã‚»ãƒ«å‘¨è¾ºã«ã‚ã‚‹åœ°é›·æ•°ã‚’æ•°ãˆã‚‹
    function countAdjacentMines(row, col) {
      let count = 0;
      for (let r = row - 1; r <= row + 1; r++) {
        for (let c = col - 1; c <= col + 1; c++) {
          if (r >= 0 && r < ROWS && c >= 0 && c < COLS) {
            if (board[r][c].isMine) count++;
          }
        }
      }
      return count;
    }

    // ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ï¼ˆãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚Šå‹•ä½œãŒå¤‰ã‚ã‚‹ï¼‰
    function onCellClick(e) {
      if (gameOver) return;
      const cellElement = e.currentTarget;
      const row = parseInt(cellElement.getAttribute("data-row"));
      const col = parseInt(cellElement.getAttribute("data-col"));
      const cell = board[row][col];
      if (modeFlag) {
        toggleFlag(cell);
      } else {
        revealCell(cell);
      }
    }

    // å³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ï¼šå¸¸ã«ãƒ•ãƒ©ã‚°åˆ‡æ›¿
    function onCellRightClick(e) {
      e.preventDefault(); // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é˜²ã
      if (gameOver) return;
      const cellElement = e.currentTarget;
      const row = parseInt(cellElement.getAttribute("data-row"));
      const col = parseInt(cellElement.getAttribute("data-col"));
      const cell = board[row][col];
      toggleFlag(cell);
    }

    // ã‚»ãƒ«ã®ãƒ•ãƒ©ã‚°ã‚’ON/OFFã™ã‚‹
    function toggleFlag(cell) {
      if (cell.revealed) return;
      cell.flagged = !cell.flagged;
      if (cell.flagged) {
        cell.element.classList.add("flagged");
        cell.element.innerHTML = `<span>ğŸš©</span>`;
      } else {
        cell.element.classList.remove("flagged");
        cell.element.innerHTML = "";
      }
    }

    // ã‚»ãƒ«ã‚’é–‹ãå‡¦ç†ï¼ˆçˆ†å¼¾ãªã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€ç©ºã‚»ãƒ«ãªã‚‰å‘¨è¾ºã‚‚æ¢ç´¢ï¼‰
    function revealCell(cell) {
      if (cell.revealed || cell.flagged) return;
      cell.revealed = true;
      cell.element.classList.add("revealed");

      if (cell.isMine) {
        // åœ°é›·ãªã‚‰çˆ†ç™ºè¡¨ç¤ºã—ã¦çµ‚äº†
        cell.element.classList.add("mine");
        cell.element.innerHTML = `<span>ğŸ’£</span>`;
        gameOver = true;
        statusText.textContent = "Game Over!";
        revealAllMines();
      } else {
        // æ•°å­—ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
        if (cell.adjacentMines > 0) {
          cell.element.innerHTML = `<span>${cell.adjacentMines}</span>`;
        }
        cellsRemaining--;
        if (cellsRemaining === 0) {
          gameOver = true;
          statusText.textContent = "You Win!";
          // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢æ™‚ã€æ®‹ã‚‹åœ°é›·ã‚‚è¡¨ç¤º
          revealAllMines(true);
        }
        // éš£æ¥ã™ã‚‹ã‚»ãƒ«ãŒ0ã®å ´åˆã¯å‘¨å›²ã‚‚è‡ªå‹•ã§é–‹ã
        if (cell.adjacentMines === 0) {
          revealAdjacentCells(cell);
        }
      }
    }

    // æŒ‡å®šã‚»ãƒ«ã®å‘¨è¾º8æ–¹å‘ã®ã‚»ãƒ«ã‚’å†å¸°çš„ã«é–‹ãï¼ˆãƒ•ãƒ©ãƒƒãƒ‰ãƒ•ã‚£ãƒ«æ¢ç´¢ï¼‰
    function revealAdjacentCells(cell) {
      for (let r = cell.row - 1; r <= cell.row + 1; r++) {
        for (let c = cell.col - 1; c <= cell.col + 1; c++) {
          if (r >= 0 && r < ROWS && c >= 0 && c < COLS) {
            let neighbor = board[r][c];
            if (!neighbor.revealed && !neighbor.isMine) {
              revealCell(neighbor);
            }
          }
        }
      }
    }

    // å…¨ã¦ã®åœ°é›·ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã¾ãŸã¯ã‚¯ãƒªã‚¢æ™‚ï¼‰
    function revealAllMines(showFlag = false) {
      for (let pos of minePositions) {
        let cell = board[pos.row][pos.col];
        if (!cell.revealed) {
          cell.revealed = true;
          cell.element.classList.add("revealed", "mine");
          cell.element.innerHTML = `<span>ğŸ’£</span>`;
        }
      }
    }

    // ãƒ¢ãƒ¼ãƒ‰ï¼ˆReveal/Flagï¼‰ã®åˆ‡æ›¿
    toggleModeBtn.addEventListener("click", () => {
      modeFlag = !modeFlag;
      toggleModeBtn.textContent = modeFlag ? "Flag Mode" : "Reveal Mode";
    });

    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã§ã‚²ãƒ¼ãƒ å†ã‚¹ã‚¿ãƒ¼ãƒˆ
    resetGameBtn.addEventListener("click", () => {
      initGame();
    });

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚²ãƒ¼ãƒ é–‹å§‹
    initGame();
  </script>
</body>
</html>